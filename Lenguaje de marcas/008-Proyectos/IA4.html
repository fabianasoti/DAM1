<!doctype html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Super Platformer üíñ Final Level</title>

<style>
body {
  margin: 0;
  background: radial-gradient(circle at top, #2a2a72, #0b0b2e);
  font-family: 'Verdana', sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

#contenedor-juego {
  position: relative;
  width: 850px;
  height: 480px;
  border-radius: 18px;
  box-shadow: 0 0 40px rgba(255,180,255,.4);
  overflow: hidden;
}

canvas {
  background: linear-gradient(to bottom, #9ad9ff, #dff6ff);
  image-rendering: pixelated;
}

#hud {
  position: absolute;
  top: 15px; left: 15px;
  background: rgba(0,0,0,.4);
  padding: 8px 18px;
  border-radius: 20px;
  color: white;
  font-size: 22px;
}
</style>
</head>

<body>
<div id="contenedor-juego">
<canvas id="miCanvas"></canvas>
<div id="hud">‚ù§ x <span id="vidasDisplay">3</span></div>
</div>

<script>
const canvas = document.getElementById("miCanvas");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;
canvas.width = 850;
canvas.height = 480;

const GRAVEDAD = 0.9;
const VELOCIDAD = 6;
const SALTO = -16;

let camaraX = 0;
let juegoActivo = true;

// Sprites
const imgJugador = new Image(); imgJugador.src = "sprite.png";
const imgEnemigo = new Image(); imgEnemigo.src = "spritenpc.png";

// =====================
// CLASES
// =====================
class Jugador {
  constructor() {
    this.w = 48; this.h = 48;
    this.vidas = 3;
    this.reiniciar();
  }
  reiniciar() {
    this.x = 100; this.y = 300;
    this.vx = 0; this.vy = 0;
    this.enSuelo = false;
    this.inv = 0;
    this.dir = 1;
  }
  actualizar() {
    if(teclas.izq){ this.vx=-VELOCIDAD; this.dir=-1 }
    else if(teclas.der){ this.vx=VELOCIDAD; this.dir=1 }
    else this.vx=0;

    if(teclas.arr && this.enSuelo){
      this.vy = SALTO;
      this.enSuelo = false;
    }

    this.vy += GRAVEDAD;
    this.x += this.vx;
    this.y += this.vy;

    this.enSuelo = false;
    plataformas.forEach(p=>{
      if(this.x+8<p.x+p.w && this.x+this.w-8>p.x &&
         this.y+this.h>p.y && this.y<p.y+p.h){
        if(this.vy>=0 && this.y+this.h-this.vy<=p.y+10){
          this.y=p.y-this.h;
          this.vy=0;
          this.enSuelo=true;
        }
      }
    });

    if(this.inv>0) this.inv--;
  }
  dibujar(){
    if(this.inv>0 && Math.floor(Date.now()/100)%2) return;
    ctx.save();
    ctx.translate(this.x-camaraX+this.w/2,this.y);
    ctx.scale(this.dir,1);
    ctx.shadowColor="rgba(0,0,0,.4)";
    ctx.shadowBlur=8;
    ctx.drawImage(imgJugador,-this.w/2,0,this.w,this.h);
    ctx.restore();
  }
  da√±o(){
    if(this.inv>0) return;
    this.vidas--;
    actualizarHUD();
    this.inv=60;
    this.vy=-10;
    if(this.vidas<=0) juegoActivo=false;
  }
}

class Enemigo{
  constructor(x,y){
    this.x=x; this.y=y;
    this.w=32; this.h=32;
    this.baseY=y;
    this.vx=2;
    this.muerto=false;
    this.squash=1;
  }
  actualizar(){
    if(this.muerto){
      this.squash=Math.max(this.squash-0.08,0.2);
      return;
    }
    this.x+=this.vx;
    this.y=this.baseY+Math.sin(Date.now()*0.005)*2;
  }
  dibujar(){
    ctx.save();
    ctx.translate(this.x-camaraX+this.w/2,this.y+this.h);
    ctx.scale(1,this.squash);
    ctx.shadowColor="rgba(0,0,0,.4)";
    ctx.shadowBlur=6;
    ctx.drawImage(imgEnemigo,-this.w/2,-this.h,this.w,this.h);
    ctx.restore();
  }
}

class Plataforma{
  constructor(x,y,w,h){ this.x=x;this.y=y;this.w=w;this.h=h; }
  dibujar(){
    ctx.fillStyle="#ffb6c1";
    ctx.beginPath();
    ctx.roundRect(this.x-camaraX,this.y,this.w,this.h,12);
    ctx.fill();
  }
}

// =====================
const jugador=new Jugador();
let plataformas=[
  new Plataforma(0,400,600,80),
  new Plataforma(650,320,150,40),
  new Plataforma(850,240,150,40),
  new Plataforma(1100,350,600,50),
  new Plataforma(2000,380,800,100)
];

let enemigos=[
  new Enemigo(1200,318),
  new Enemigo(1500,318)
];

let teclas={izq:false,der:false,arr:false};

function bucle(){
  if(!juegoActivo) return;

  jugador.actualizar();
  camaraX+=(jugador.x-200-camaraX)*0.1;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  plataformas.forEach(p=>p.dibujar());
  enemigos.forEach(e=>{
    e.actualizar();
    e.dibujar();
    if(!e.muerto && colision(jugador,e)){
      if(jugador.vy>0){
        e.muerto=true;
        jugador.vy=-12;
      } else jugador.da√±o();
    }
  });

  jugador.dibujar();
  requestAnimationFrame(bucle);
}

function colision(a,b){
  return a.x<a.x+b.w && a.x+a.w>b.x && a.y<a.y+b.h && a.y+a.h>b.y;
}

function actualizarHUD(){
  document.getElementById("vidasDisplay").textContent=jugador.vidas;
}

// INPUT
addEventListener("keydown",e=>{
  if(e.key==="a"||e.key==="ArrowLeft") teclas.izq=true;
  if(e.key==="d"||e.key==="ArrowRight") teclas.der=true;
  if(e.key==="w"||e.key===" "||e.key==="ArrowUp") teclas.arr=true;
});
addEventListener("keyup",e=>{
  if(e.key==="a"||e.key==="ArrowLeft") teclas.izq=false;
  if(e.key==="d"||e.key==="ArrowRight") teclas.der=false;
  if(e.key==="w"||e.key===" "||e.key==="ArrowUp") teclas.arr=false;
});

actualizarHUD();
bucle();
</script>
</body>
</html>

