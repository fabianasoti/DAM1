<!doctype html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Pac-Platformer ✨</title>

<style>
body{
  background: radial-gradient(circle at top, #050514, #000);
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
  font-family:'Courier New', monospace;
}

canvas{
  border-radius:18px;
  border:3px solid rgba(255,255,255,0.15);
  background: linear-gradient(to bottom, #05052a, #1b1b4d);
  box-shadow:
    0 0 30px rgba(0,150,255,0.5),
    inset 0 0 25px rgba(255,255,255,0.08);
}
</style>
</head>

<body>
<canvas></canvas>

<script>
// =====================
// CANVAS
// =====================
const canvas = document.querySelector("canvas");
const ctx = canvas.getContext("2d");
canvas.width = 600;
canvas.height = 500;

let gravedad = 0.6;
let fps = 1000/60;
let temporizador;
let puntuacion = 0;
let invulnerable = 0;
let juegoActivo = true;

// =====================
// FONDO ESTRELLAS
// =====================
const estrellas=[];
for(let i=0;i<80;i++){
  estrellas.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    r:Math.random()*2+0.5,
    v:Math.random()*0.4+0.1
  });
}

function dibujarFondo(){
  estrellas.forEach(e=>{
    e.y+=e.v;
    if(e.y>canvas.height) e.y=0;
    ctx.fillStyle="rgba(255,255,255,0.7)";
    ctx.beginPath();
    ctx.arc(e.x,e.y,e.r,0,Math.PI*2);
    ctx.fill();
  });
}

// =====================
// SPRITES (NATURALES)
// =====================
const spriteJugador = new Image();
spriteJugador.src = "sprite.png";

const spriteNpc = new Image();
spriteNpc.src = "spritenpc.png";

const spriteMoneda = new Image();
spriteMoneda.src = "coin.png"; // opcional

// =====================
// CLASES
// =====================
class Jugador{
  constructor(){
    this.x=50; this.y=400;
    this.w=32; this.h=32;
    this.vx=0; this.vy=0;
    this.speed=1.5;
    this.friction=0.85;
    this.jump=-14;
    this.vidas=3;
    this.enSuelo=false;
    this.bob=Math.random()*Math.PI*2;
  }

  actualizar(){
    aplicarInput();
    this.vx*=this.friction;
    this.x+=this.vx;

    this.vy+=gravedad;
    this.y+=this.vy;

    this.enSuelo=false;
    plataformas.forEach(p=>{
      if(this.x+this.w>p.x && this.x<p.x+p.w){
        if(this.y+this.h>=p.y && this.y+this.h<=p.y+p.h && this.vy>=0){
          this.y=p.y-this.h;
          this.vy=0;
          this.enSuelo=true;
        }
      }
    });

    this.bob+=0.05;
    this.dibujar(Math.sin(this.bob)*2);
  }

  dibujar(offset){
    ctx.save();
    ctx.shadowColor="rgba(255,215,0,0.7)";
    ctx.shadowBlur=20;
    ctx.drawImage(spriteJugador,this.x,this.y+offset);
    ctx.restore();
  }
}

class Fantasma{
  constructor(x,y,v){
    this.x=x; this.y=y;
    this.w=32; this.h=32;
    this.vx=v;
    this.bob=Math.random()*Math.PI*2;
  }

  actualizar(){
    this.x+=this.vx;
    if(this.x<0||this.x+this.w>canvas.width) this.vx*=-1;
    this.bob+=0.04;
    ctx.save();
    ctx.shadowColor="cyan";
    ctx.shadowBlur=15;
    ctx.drawImage(spriteNpc,this.x,this.y+Math.sin(this.bob)*3);
    ctx.restore();
  }
}

class Plataforma{
  constructor(x,y,w,h){this.x=x;this.y=y;this.w=w;this.h=h;}
  dibujar(){
    ctx.fillStyle="#5b2d14";
    ctx.fillRect(this.x,this.y,this.w,this.h);
  }
}

class Moneda{
  constructor(x,y){
    this.x=x; this.y=y;
    this.w=16; this.h=16;
    this.t=Math.random()*Math.PI*2;
    this.recogida=false;
  }
  actualizar(){
    if(this.recogida) return;
    this.t+=0.1;
    ctx.save();
    ctx.shadowColor="gold";
    ctx.shadowBlur=15;
    if(spriteMoneda.complete && spriteMoneda.naturalWidth){
      ctx.drawImage(spriteMoneda,this.x,this.y+Math.sin(this.t)*4);
    }else{
      ctx.fillStyle="gold";
      ctx.beginPath();
      ctx.arc(this.x+8,this.y+8+Math.sin(this.t)*4,8,0,Math.PI*2);
      ctx.fill();
    }
    ctx.restore();
  }
}

// =====================
// JUEGO
// =====================
const jugador = new Jugador();

const plataformas=[
  new Plataforma(0,470,600,30),
  new Plataforma(150,350,150,20),
  new Plataforma(350,260,150,20),
  new Plataforma(250,150,100,20)
];

const fantasmas=[
  new Fantasma(50,315,2),
  new Fantasma(450,235,-2.5)
];

const monedas=[];
plataformas.forEach(p=>{
  if(p.y<450){
    for(let i=0;i<p.w;i+=40){
      monedas.push(new Moneda(p.x+i+10,p.y-30));
    }
  }
});

// =====================
// CONTROLES
// =====================
const teclas={};
document.onkeydown=e=>{
  teclas[e.key]=true;
  if((e.key==="w"||e.key===" ")&&jugador.enSuelo){
    jugador.vy=jugador.jump;
  }
};
document.onkeyup=e=>teclas[e.key]=false;

function aplicarInput(){
  if(teclas["a"]) jugador.vx-=jugador.speed;
  if(teclas["d"]) jugador.vx+=jugador.speed;
}

// =====================
// COLISIÓN
// =====================
function colision(a,b){
  let dx=(a.x+a.w/2)-(b.x+b.w/2);
  let dy=(a.y+a.h/2)-(b.y+b.h/2);
  return Math.sqrt(dx*dx+dy*dy)<20;
}

// =====================
// BUCLE
// =====================
function bucle(){
  if(!juegoActivo) return;

  ctx.clearRect(0,0,canvas.width,canvas.height);
  dibujarFondo();

  plataformas.forEach(p=>p.dibujar());
  monedas.forEach(m=>{
    m.actualizar();
    if(!m.recogida && colision(jugador,m)){
      m.recogida=true;
      puntuacion+=100;
    }
  });

  jugador.actualizar();

  fantasmas.forEach(f=>{
    f.actualizar();
    if(invulnerable<=0 && colision(jugador,f)){
      jugador.vidas--;
      invulnerable=60;
      if(jugador.vidas<=0) gameOver();
    }
  });

  invulnerable=Math.max(0,invulnerable-1);

  ctx.fillStyle="white";
  ctx.font="20px Courier New";
  ctx.fillText("PUNTOS: "+puntuacion,20,30);
  ctx.fillText("VIDAS: "+jugador.vidas,450,30);

  temporizador=setTimeout(bucle,fps);
}

function gameOver(){
  juegoActivo=false;
  clearTimeout(temporizador);
  ctx.fillStyle="rgba(0,0,0,0.8)";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="white";
  ctx.font="28px Courier New";
  ctx.textAlign="center";
  ctx.fillText("GAME OVER",canvas.width/2,canvas.height/2);
}

bucle();
</script>
</body>
</html>

